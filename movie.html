<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Tonton Film</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #000; }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 space-y-4">

  <h1 id="movie-title" class="text-white text-2xl font-bold"></h1>

  <!-- Video Player -->
  <div id="video-player-container" class="w-full max-w-4xl"></div>

  <!-- Next Episode -->
  <div id="next-episode" class="hidden">
    <a id="next-link"
       href="#"
       class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white">
       ▶ Next Episode
    </a>
  </div>

 <script>
  const urlParams = new URLSearchParams(window.location.search);
  const movieId = parseInt(urlParams.get("id"));
  let nextMovie = null;

  fetch("movies.json")
    .then(res => res.json())
    .then(data => {
      const movie = data.find(m => m.id === movieId);
      const playerContainer = document.querySelector("#video-player-container");

      if (movie) {
        document.getElementById("movie-title").textContent = movie.title;
        
        // Buat pemutar video sesuai tipenya
        if (movie.type === "wistia") {
          // Buat pemutar Wistia
          playerContainer.innerHTML = `
            <div class="rounded shadow-lg w-full max-w-4xl" style="position:relative;height:0;padding-bottom:56.25%">
                <script src="https://fast.wistia.com/embed/medias/${movie.src}.jsonp" async></script>
                <script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>
                <div class="wistia_embed wistia_async_${movie.src} popover=true" style="position:absolute;left:0;top:0;height:100%;width:100%">&nbsp;</div>
            </div>
          `;
        } else if (movie.src.includes(".m3u8") || movie.src.includes(".mpd")) {
          // Buat iframe untuk video HLS/DASH
          playerContainer.innerHTML = `
            <iframe
              class="rounded shadow-lg w-full max-w-4xl"
              src="${movie.src}"
              width="560"
              height="315"
              frameBorder="0"
              allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen"
            ></iframe>
          `;
        } else {
          // Gunakan tag video untuk video mp4
          playerContainer.innerHTML = `
            <video
              id="my-video"
              class="rounded shadow-lg w-full max-w-4xl"
              controls
              preload="auto">
              <source src="${movie.src}" type="video/mp4" />
              Browser tidak mendukung video.
            </video>
          `;
          const player = document.getElementById("my-video");
          player.load();
        }

        // --- Logika untuk Next Episode (tetap sama) ---
        nextMovie = data.find(m => m.id === movieId + 1);
        if (nextMovie) {
          const nextEpisodeDiv = document.getElementById("next-episode");
          const nextLink = document.getElementById("next-link");
          nextLink.href = `movie.html?id=${nextMovie.id}`;
          nextLink.textContent = `▶ Next Episode: ${nextMovie.title}`;
          nextEpisodeDiv.classList.remove("hidden");
        }
        
        // Logika auto-play next episode (hanya untuk video MP4)
        if (!movie.src.includes(".m3u8") && !movie.src.includes(".mpd") && movie.type !== "wistia") {
            const player = document.getElementById("my-video");
            player.addEventListener("ended", () => {
              if (nextMovie) {
                window.location.href = `movie.html?id=${nextMovie.id}`;
              }
            });
        }
      } else {
        document.body.innerHTML = "<p class='text-white'>Film tidak ditemukan.</p>";
      }
    });
</script>
</body>
</html>
