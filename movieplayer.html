<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TokuMovie Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* Memastikan video memenuhi lebar container */
        #videoPlayer {
            width: 100%;
            height: auto;
            min-height: 200px; /* Minimal tinggi agar terlihat */
            background-color: black;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

    <header class="bg-blue-600 text-white shadow-lg">
        <div class="max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold">‚Üê Toku Movie</a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        
        <div class="bg-white rounded-lg shadow-xl overflow-hidden mb-6">
            <video id="videoPlayer" controls autoplay></video>
        </div>

        <div class="p-4 bg-white rounded-lg shadow-md border-t-4 border-blue-600">
            <p id="videoCategory" class="text-sm font-semibold text-blue-600 uppercase mb-1"></p>
            <h1 id="videoTitle" class="text-2xl font-bold text-gray-800">Memuat...</h1>
            <h2 id="videoSubtitle" class="text-lg text-gray-600 mb-2"></h2>
            <p id="videoEpisode" class="text-md text-gray-500"></p>
        </div>

    </main>

    <script>
        // File path ke data JSON Anda
        const JSON_URL = './data/videos.json';
        
        const videoPlayer = document.getElementById('videoPlayer');
        const videoTitle = document.getElementById('videoTitle');
        const videoSubtitle = document.getElementById('videoSubtitle');
        const videoEpisode = document.getElementById('videoEpisode');
        const videoCategory = document.getElementById('videoCategory');

        /** Mendapatkan ID Video dari URL (misal: ?id=zeroone_01) */
        function getVideoIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        /** Mengambil data JSON dan mencari video yang sesuai */
        async function loadVideo() {
            const videoId = getVideoIdFromUrl();
            if (!videoId) {
                videoTitle.textContent = "Error: ID video tidak ditemukan.";
                return;
            }

            try {
                // Fetch data dari file videos.json
                const response = await fetch(JSON_URL);
                if (!response.ok) {
                    throw new Error(`Gagal memuat file JSON: ${response.statusText}`);
                }
                const videos = await response.json();
                
                // Cari data video yang sesuai dengan ID
                const videoData = videos.find(v => v.id === videoId);

                if (videoData) {
                    displayVideoDetails(videoData);
                    playHlsVideo(videoData.url);
                } else {
                    videoTitle.textContent = `Error: Video dengan ID "${videoId}" tidak ditemukan.`;
                }

            } catch (error) {
                console.error("Kesalahan saat memuat data:", error);
                videoTitle.textContent = `Error: Gagal memuat data video. Cek file videos.json.`;
            }
        }

        /** Memainkan video HLS menggunakan HLS.js */
        function playHlsVideo(videoUrl) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(videoPlayer);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    videoPlayer.play();
                });
            } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                // Solusi fallback untuk Safari (yang mendukung HLS secara native)
                videoPlayer.src = videoUrl;
                videoPlayer.addEventListener('loadedmetadata', function() {
                    videoPlayer.play();
                });
            } else {
                videoTitle.textContent = "Error: Browser Anda tidak mendukung pemutaran HLS.";
            }
        }

        /** Memperbarui detail tampilan */
        function displayVideoDetails(data) {
            videoTitle.textContent = data.title;
            videoSubtitle.textContent = data.subtitle;
            videoEpisode.textContent = data.episode;
            videoCategory.textContent = data.category;
            document.title = `${data.title} ${data.episode} | TokuMovie`;
        }

        // Jalankan saat halaman dimuat
        document.addEventListener('DOMContentLoaded', loadVideo);
    </script>
</body>
</html>
